<template>
  <view>
    <view wx:for="{{ list }}" wx:key="key" class="mpx-devtools-property-item">
      <!-- éå¯å±•å¼€å±æ€§ -->
      <view class="mpx-devtools-property-item__content" wx:if="{{ !item.isExpandable }}">
        <view class="mpx-devtools-copy-btn" bindtap="copyPropertyValue"
          data-value="{{ item.expandedValue || item.displayValue }}"
          data-key="{{ item.key }}" data-type="{{ type }}">
          <text class="mpx-devtools-copy-btn__icon">ğŸ“‹</text>
        </view>
        <text class="mpx-devtools-property-item__key {{ item.isMatched ? 'mpx-devtools-property-item__key--matched' : '' }}">{{ item.key }}:</text>
        <text class="mpx-devtools-property-item__value" style="color: {{ item.valueColor }}">{{ item.displayValue }}</text>
      </view>
      <!-- å¯å±•å¼€å±æ€§ -->
      <view class="mpx-devtools-property-item__content mpx-devtools-property-item__content--expandable" wx:else>
        <view class="mpx-devtools-property-item__expandable-header" bindtap="toggleObjectExpand"
          data-path="{{ item.path }}" data-type="{{ type }}">
          <view class="mpx-devtools-copy-btn mpx-devtools-copy-btn--expandable" bindtap="copyPropertyValue"
            data-value="{{ item.expandedValue }}" data-key="{{ item.key }}"
            data-type="{{ type }}" catchtap="preventToggle">
            <text class="mpx-devtools-copy-btn__icon">ğŸ“‹</text>
          </view>
          <text class="mpx-devtools-property-item__key {{ item.isMatched ? 'mpx-devtools-property-item__key--matched' : '' }}">{{ item.key }}:</text>
          <text class="mpx-devtools-property-item__expand-icon">{{ item.expanded ? 'âˆ’' : '+' }}</text>
          <text class="mpx-devtools-property-item__value" style="color: {{ item.valueColor }}">{{ item.collapsedValue }}</text>
        </view>
      </view>
      <!-- å±•å¼€åçš„å†…å®¹ -->
      <view wx:if="{{ item.expanded }}" class="mpx-devtools-property-item__expanded-content">
        <view bindtap="toggleObjectExpand" data-path="{{ item.path }}" data-type="{{ type }}"
          class="mpx-devtools-property-item__value" style="color: {{ item.valueColor }}">
          {{ item.displayValue }}
        </view>
      </view>
    </view>
    <text wx:if="{{ !list || list.length === 0 }}" class="mpx-devtools-empty-state__text">æ— æ•°æ®</text>
  </view>
</template>
<script type="application/json">
{
  "component": true
}
</script>
<script>
import mpx, { createComponent } from '@mpxjs/core'

createComponent({
  props: {
    list: {
      type: Array,
      value: []
    },
    type: {
      type: String,
      value: ''
    }
  },
  methods: {
    toggleObjectExpand(e) {
      const path = e.currentTarget.dataset.path
      const type = this.type
      // ç›´æ¥åœ¨ list ä¸­æŸ¥æ‰¾å¹¶åˆ‡æ¢å±•å¼€çŠ¶æ€
      const item = this.list.find(item => item.path === path)
      if (item && item.isExpandable) {
        item.expanded = !item.expanded
        item.displayValue = item.expanded ? item.expandedValue : item.collapsedValue
        this.setData({ list: this.list })
      }
    },
    preventToggle() {},
    copyPropertyValue(e) {
      const { value, key } = e.currentTarget.dataset
      mpx.setClipboardData({
        data: value || '',
        success: () => {
          mpx.showToast({
            title: `å·²å¤åˆ¶${key}`,
            icon: 'success',
            duration: 1500
          })
        },
        fail: () => {
          mpx.showToast({
            title: 'å¤åˆ¶å¤±è´¥',
            icon: 'none',
            duration: 1500
          })
        }
      })
    }
  }
})
</script>
<style lang="stylus">
/* ==============================================
8. å±æ€§é¡¹æ ·å¼ï¼ˆProperty Itemï¼‰
============================================== */
.mpx-devtools-copy-btn__icon 
    margin-right 4rpx
.mpx-devtools-property-item
    margin-bottom 16rpx
    border-radius 6rpx
    transition background-color 0.2s ease

.mpx-devtools-property-item:last-child
    margin-bottom 0

.mpx-devtools-property-item:hover
    background-color rgba(248, 249, 250, 0.5)

/* å±æ€§å†…å®¹å®¹å™¨ */
.mpx-devtools-property-item__content
    display flex
    align-items flex-start
    align-items center
    font-family 'Monaco', 'Menlo', 'Ubuntu Mono', monospace
    font-size 24rpx
    margin-bottom 8rpx
    padding 8rpx 0
    position relative

/* éå¯å±•å¼€å±æ€§çš„valueæ ·å¼ */
.mpx-devtools-property-item__content:not(.mpx-devtools-property-item__content--expandable) .mpx-devtools-property-item__value
    background-color rgba(248, 249, 250, 0.3)
    padding 4rpx 8rpx
    border-radius 4rpx
    border 1rpx solid rgba(230, 230, 230, 0.3)
    box-shadow 0 1rpx 3rpx rgba(0, 0, 0, 0.03)
    margin-top 0
    margin-left 8rpx
    flex 1

/* å¯å±•å¼€å±æ€§çš„å†…å®¹å®¹å™¨ */
.mpx-devtools-property-item__content--expandable
    flex-direction column
    align-items stretch

/* å¯å±•å¼€å±æ€§çš„å¤´éƒ¨ */
.mpx-devtools-property-item__expandable-header
    display flex
    align-items center
    cursor pointer
    padding 5rpx 0
    width 100%
    min-height 40rpx

/* å±•å¼€/æ”¶èµ·å›¾æ ‡ */
.mpx-devtools-property-item__expand-icon
    width 30rpx
    height 30rpx
    font-size 20rpx
    color #666
    margin-right 10rpx
    text-align center
    font-weight bold
    transition color 0.3s ease
    display flex
    align-items center
    justify-content center
    background-color rgba(230, 230, 230, 0.3)
    border-radius 4rpx
    flex-shrink 0

.mpx-devtools-property-item__expandable-header:hover .mpx-devtools-property-item__expand-icon
    color #1890ff
    background-color rgba(24, 144, 255, 0.1)

.mpx-devtools-property-item__expandable-header:active .mpx-devtools-property-item__expand-icon
    transform scale(0.95)
    transition transform 0.1s ease

/* å±æ€§Key */
.mpx-devtools-property-item__key
    color #0366d6
    margin-right 15rpx
    font-weight 500
    min-width 200rpx
    flex-shrink 0
    display inline-block
    transition color 0.3s ease

/* å±æ€§Keyä¿®æ”¹å™¨ï¼šåŒ¹é…çŠ¶æ€ */
.mpx-devtools-property-item__key--matched
    color #dc2626
    font-weight 600
    text-shadow 0 1rpx 2rpx rgba(220, 38, 38, 0.2)
    background rgba(220, 38, 38, 0.1)
    padding 4rpx 8rpx
    border-radius 4rpx
    border 1rpx solid rgba(220, 38, 38, 0.2)

/* å±æ€§Value */
.mpx-devtools-property-item__value
    color #333
    word-break break-all
    flex 1
    white-space pre-wrap // ä¿æŒç©ºæ ¼å’Œæ¢è¡Œç¬¦
    font-family 'Monaco', 'Menlo', 'Ubuntu Mono', monospace
    line-height 1.4
    max-height 400rpx
    overflow-y auto
    background-color rgba(248, 249, 250, 0.8)
    padding 12rpx 16rpx
    border-radius 8rpx
    margin-top 8rpx
    border 1rpx solid rgba(230, 230, 230, 0.6)
    box-shadow 0 2rpx 8rpx rgba(0, 0, 0, 0.05), 0 1rpx 2rpx rgba(0, 0, 0, 0.1)
    position relative

/* å±•å¼€åçš„å†…å®¹ */
.mpx-devtools-property-item__expanded-content
    margin-left 40rpx
    margin-top 10rpx
    padding-left 20rpx
    border-left 2rpx solid #e1e4e8

</style>
