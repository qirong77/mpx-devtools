<template>
    <view>
        <view
            class="mpx-devtools-container {{ isDrageMove ? 'mpx-devtools-container--floating' : '' }} {{ isCollapsed ? 'mpx-devtools-container--collapsed' : '' }}"
            style="{{ isDrageMove ? 'left: ' + dragPosition.x + '%; top: ' + dragPosition.y + '%; width: ' + containerSize.width + 'rpx; height: ' + containerSize.height + 'rpx;' : '' }}">
            <!-- å¤´éƒ¨åŒºåŸŸ -->
                <view class="mpx-devtools-header {{ isCollapsed ? 'mpx-devtools-header--collapsed' : '' }}"
                bindtouchstart="{{ isDrageMove ? 'onTouchStart' : '' }}"
                catchtouchmove="{{ isDrageMove ? 'onTouchMove' : '' }}"
                bindtouchend="{{ isDrageMove ? 'onTouchEnd' : '' }}">
                <!-- æ‹–æ‹½æŒ‡ç¤ºå™¨ -->
                <view wx:if="{{ isDrageMove }}" class="mpx-devtools-drag-indicator">
                    <text class="mpx-devtools-drag-icon">â‹®â‹®</text>
                </view>
                <!-- å¤´éƒ¨é¡¶éƒ¨ï¼ˆæ ‡é¢˜+çŠ¶æ€ï¼‰ -->
                <view class="mpx-devtools-header__top">
                    <view class="mpx-devtools-title-section">
                        <text class="mpx-devtools-title">ğŸŒ² MPX DevTools</text>
                    </view>
                    <!-- åˆ·æ–°æŒ‰é’®ï¼ˆéæŠ˜å æ—¶æ˜¾ç¤ºï¼‰ -->
                    <!-- <view wx:if="{{ !isCollapsed }}" class="mpx-devtools-status-section" style="margin-left: 4px;">
                        <text class="mpx-devtools-update-time" bindtap="updateComponentTree">ğŸ•’ åˆ·æ–°</text>
                    </view> -->
                    <!-- æŠ˜å æŒ‰é’® -->
                    <view class="mpx-devtools-status-section">
                        <view class="mpx-devtools-collapse-btn" bindtap="toggleCollapseGlobal">
                            <text class="mpx-devtools-collapse-btn__icon">{{ isCollapsed ? 'ğŸ“‹' : 'ğŸ“' }}</text>
                            <text class="mpx-devtools-collapse-btn__text">{{ isCollapsed ? 'å±•å¼€' : 'æ”¶èµ·' }}</text>
                        </view>
                    </view>
                </view>
                <!-- ç¯å¢ƒè®¾ç½®åŒºåŸŸï¼ˆéæŠ˜å æ—¶æ˜¾ç¤ºï¼‰ -->
                <view wx:if="{{ !isCollapsed && showOsimEnvInput }}" class="mpx-devtools-env">
                    <view class="mpx-devtools-env__label">
                        <text>osim{{ '__' }}</text>
                        <text class="mpx-devtools-env__current">{{ ' ' + osimEnv || 'æœªè®¾ç½®' }}</text>
                    </view>
                    <view class="mpx-devtools-env__controls">
                        <input class="mpx-devtools-env__input" bindblur="onOsimEnvInputBlur" type="number"
                            placeholder="è¾“å…¥ç¯å¢ƒç¼–å·ï¼ˆå¦‚ï¼š1ï¼‰" value="{{ osimEnvInput }}" bindinput="onOsimEnvInput" />
                        <text class="mpx-devtools-env__btn" bindtap="confirmOsimEnv">ä¿®æ”¹</text>
                    </view>
                </view>
            </view>
            <view style="flex: 1;position: relative;overflow: hidden;">
                <!-- ä¸»ä½“å†…å®¹åŒºï¼ˆéæŠ˜å æ—¶æ˜¾ç¤ºï¼‰ -->
                <view class="mpx-devtools-main" wx:if="{{ !isCollapsed }}">
                    <view wx:if="{{ !isCollapsed }}" class="mpx-devtools-filter-container">
                        <view class="mpx-devtools-filter-wrapper">
                            <text class="mpx-devtools-filter-wrapper__icon">ğŸ”</text>
                            <input class="mpx-devtools-filter-wrapper__input" placeholder="æœç´¢ç»„ä»¶åç§°æˆ–æ•°æ®å€¼"
                                value="{{ filterText }}" bindinput="onFilterInput" bindconfirm="onFilterConfirm" />
                            <!-- æ¸…é™¤æŒ‰é’®ï¼ˆæœ‰è¿‡æ»¤æ–‡æœ¬æ—¶æ˜¾ç¤ºï¼‰ -->
                            <view wx:if="{{ filterText }}" class="mpx-devtools-filter-wrapper__clear-btn"
                                bindtap="clearFilter">
                                <text class="mpx-devtools-filter-wrapper__clear-icon">Ã—</text>
                            </view>
                        </view>
                    </view>
                    <!-- ç»„ä»¶æ ‘å®¹å™¨ -->
                    <view class="mpx-devtools-tree-container" wx:if="{{ visibleNodesWithDisplayName.length > 0 }}">
                        <view wx:for="{{ visibleNodesWithDisplayName }}" wx:key="index" class="mpx-devtools-tree-node"
                            style="padding-left: {{item.level * 20}}px;">
                            <view class="mpx-devtools-tree-node__content">
                                <!-- èŠ‚ç‚¹æŠ˜å æŒ‰é’® -->
                                <view class="mpx-devtools-tree-node__collapse-btn"
                                    style="opacity: {{ item.hasChildren ? 1 : 0.3 }}" bindtap="toggleCollapse"
                                    data-index="{{ index }}">
                                    <text class="mpx-devtools-tree-node__collapse-icon">{{ item.collapsed ? '+' : '-'
                                        }}</text>
                                </view>
                                <!-- èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’® -->
                                <view class="mpx-devtools-tree-node__info-btn" bindtap="showComponentInfo"
                                    data-index="{{ index }}">
                                    <text class="mpx-devtools-tree-node__info-icon">!</text>
                                </view>
                                <!-- èŠ‚ç‚¹æ–‡ä»¶ä¿¡æ¯ -->
                                <view class="mpx-devtools-tree-node__file-container">
                                    <text
                                        class="mpx-devtools-tree-node__text {{ item.isHighlighted ? 'mpx-devtools-tree-node__text--highlighted' : '' }}">{{
                                            item.displayFileName }}</text>
                                    <!-- åŒ¹é…çš„å±æ€§ï¼ˆæ•°æ®æœç´¢æ—¶æ˜¾ç¤ºï¼‰ -->
                                    <view wx:if="{{ item.matchedProperties.length > 0 }}"
                                        class="mpx-devtools-tree-node__matched-properties">
                                        <text wx:for="{{ item.matchedProperties }}" wx:key="prop"
                                            class="mpx-devtools-tree-node__matched-prop">{{
                                                item
                                            }}</text>
                                    </view>
                                </view>
                            </view>
                        </view>
                    </view>
                    <!-- ç©ºçŠ¶æ€ï¼ˆæ— ç»„ä»¶æ•°æ®æ—¶æ˜¾ç¤ºï¼‰ -->
                    <view wx:else class="mpx-devtools-empty-state">
                        <text class="mpx-devtools-empty-state__text">æš‚æ— ç»„ä»¶æ•°æ®</text>
                        <text class="mpx-devtools-empty-state__hint">è¯·ç‚¹å‡»å³ä¸Šè§’åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°ç»„ä»¶æ ‘<br />æˆ–ä¿®æ”¹è¿‡æ»¤æ¡ä»¶</text>
                    </view>
                </view>
            </view>


            <!-- æ‹‰ä¼¸æ§åˆ¶å™¨ï¼ˆæ‚¬æµ®+éæŠ˜å æ—¶æ˜¾ç¤ºï¼‰ -->
                <view wx:if="{{ isDrageMove && !isCollapsed }}" class="mpx-devtools-resize-controls">
                <view class="mpx-devtools-resize-handle mpx-devtools-resize-handle--br" bindtouchstart="onResizeStart"
                    catchtouchmove="onTouchMove" bindtouchend="onTouchEnd" data-action="resize">
                    <text class="mpx-devtools-resize-handle__icon">âŸ²</text>
                </view>
            </view>
        </view>

        <!-- ç»„ä»¶ä¿¡æ¯å¼¹çª—ï¼ˆæ˜¾ç¤ºæ—¶æ¸²æŸ“ï¼‰ -->
        <view wx:if="{{ showInfoModal }}" class="mpx-devtools-modal-overlay" bindtap="closeInfoModal">
            <view class="mpx-devtools-modal" catchtap="preventClose">
                <!-- å¼¹çª—å¤´éƒ¨ -->
                <view class="mpx-devtools-modal__header">
                    <text class="mpx-devtools-modal__title">ç»„ä»¶ä¿¡æ¯</text>
                    <view class="mpx-devtools-modal__close-btn" bindtap="closeInfoModal">
                        <text class="mpx-devtools-modal__close-icon">Ã—</text>
                    </view>
                </view>
                <mpx-devtool-tab bind:tabchange="onTabChange" tabList="{{ tabList }}" activeTab="{{ activeTab }}">

                </mpx-devtool-tab>
                <!-- å¼¹çª—å†…å®¹ -->
                <view class="mpx-devtools-modal__content">
                    <!-- ç»„ä»¶è·¯å¾„ -->
                    <view class="mpx-devtools-component-path">
                        <view class="mpx-devtools-copy-btn" bindtap="copyPropertyValue"
                            data-value="{{ currentComponentInfo.fileSrc }}" data-key="{{ 'è·¯å¾„' }}">
                            <text class="mpx-devtools-copy-btn__icon">ğŸ“‹</text>
                        </view>
                        <text class="mpx-devtools-component-path__label">ç»„ä»¶è·¯å¾„</text>
                        <text class="mpx-devtools-component-path__text">{{ currentComponentInfo.fileSrc }}</text>
                    </view>

                    <view class="mpx-devtools-section">
                        <view class="mpx-devtools-section__content">
                            <mpx-devtools-data wx:if="{{ activeTab === 'props' }}"
                                list="{{ currentComponentInfo.props }}" type="props" />
                            <mpx-devtools-data wx:if="{{ activeTab === 'data' }}" list="{{ currentComponentInfo.data }}"
                                type="data" />
                            <mpx-devtools-data wx:if="{{ activeTab === 'computed' }}"
                                list="{{ currentComponentInfo.computed }}" type="computed" />

                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>
</template>
<script type="application/json">
{
    "usingComponents": {
        "mpx-devtool-tab": "./components/mpx-devtool-tab.mpx",
        "mpx-devtools-data": "./components/mpx-devtools-data.mpx",
    }
}
</script>
<script>
import mpx, { createComponent, ONHIDE, UNMOUNTED, BEFOREUNMOUNT,MOUNTED } from '@mpxjs/core'
  import mpx_devtools from '@mpxjs/core'

createComponent({
    data: {
        isDrageMove: true,
        componentTree: null,
        flattenTree: [],
        visibleNodes: [],
        updateTime: '',
        timer: null,
        showInfoModal: false,
        currentComponentInfo: null,
        filterText: '',
        rootInstance: null,
        dataSearchResults: new Map(), // å­˜å‚¨æ•°æ®æœç´¢ç»“æœ
        isCollapsed: false,
        // æ‹–æ‹½ç›¸å…³æ•°æ®
        dragPosition: { x: 50, y: 50 }, // æ‚¬æµ®æ—¶çš„ä½ç½® (ç™¾åˆ†æ¯”)
        containerSize: { width: 600, height: 400 }, // å®¹å™¨å°ºå¯¸ (rpx)
        isDragging: false,
        isResizing: false,
        dragStartPos: { x: 0, y: 0 },
        dragOffset: { x: 0, y: 0 },
        resizeStartPos: { x: 0, y: 0 },
        resizeStartSize: { width: 0, height: 0 },
        activeTab: 'props',
        showOsimEnvInput: process.env.VUE_APP_ENV === 'osim',
        osimEnv: '',
        osimEnvInput: '',
    },

    methods: {
        clearTimer() {
            if (this.timer) {
                clearInterval(this.timer)
                this.timer = null
                console.debug('MPX DevTools timer cleared')
            }
            // æ¸…ç†èŠ‚æµè®¡æ—¶å™¨
            if (this._throttleTimer) {
                clearTimeout(this._throttleTimer)
                this._throttleTimer = null
            }
        },
        onTabChange(data) {
            const tab = data.detail?.activeTab;
            this.activeTab = tab;
        },
        onOsimEnvInput(e) {
            this.osimEnvInput = e.detail.value;
        },
        onOsimEnvInputBlur(e) {
            const isValid = /[\d]+/.test(e.detail.value);
            if (!isValid) {
                mpx.showToast({
                    title: 'è¯·è¾“å…¥æ­£ç¡®çš„ç¯å¢ƒå€¼',
                    icon: 'none',
                    duration: 1500
                });
                this.osimEnvInput = this.osimEnv;
                return;
            }
        },
        confirmOsimEnv() {
            const isValid = /[\d]+/.test(this.osimEnvInput);
            if (!isValid) {
                mpx.showToast({
                    title: 'è¯·è¾“å…¥æ­£ç¡®çš„ç¯å¢ƒå€¼',
                    icon: 'none',
                    duration: 1500
                });
                return;
            }
            this.osimEnv = this.osimEnvInput;
            mpx.setStorage({
                key: 'osimEnv',
                data: this.osimEnv
            });
            mpx.reLaunch();
        },
        // æœ¬åœ°å­˜å‚¨ç›¸å…³æ–¹æ³•
        saveToStorage() {
            try {
                const storageData = {
                    isCollapsed: this.isCollapsed,
                    dragPosition: this.dragPosition,
                    containerSize: this.containerSize
                }
                mpx.setStorageSync('mpx-devtools-settings', JSON.stringify(storageData))
            } catch (error) {
                console.debug('Save storage failed:', error)
            }
        },

        loadFromStorage() {
            try {
                const storageData = mpx.getStorageSync('mpx-devtools-settings')
                if (storageData) {
                    const data = JSON.parse(storageData)
                    if (typeof data.isCollapsed === 'boolean') {
                        this.isCollapsed = data.isCollapsed
                    }
                    if (data.dragPosition && typeof data.dragPosition.x === 'number' && typeof data.dragPosition.y === 'number') {
                        this.dragPosition = { ...data.dragPosition }
                    }
                    if (data.containerSize && typeof data.containerSize.width === 'number' && typeof data.containerSize.height === 'number') {
                        this.containerSize = { ...data.containerSize }
                    }
                }
            } catch (error) {
                console.debug('Load storage failed:', error)
            }
        },

        // æ‹–æ‹½ç›¸å…³æ–¹æ³•
        onTouchStart(e) {
            if (!this.isDrageMove) return

            const touch = e.touches[0]
            const target = e.currentTarget.dataset.action

            if (target === 'resize') {
                this.isResizing = true
                this.resizeStartPos = {
                    x: touch.pageX,
                    y: touch.pageY
                }
                this.resizeStartSize = { ...this.containerSize }
            } else {
                this.isDragging = true
                this.dragStartPos = {
                    x: touch.pageX,
                    y: touch.pageY
                }
            }
        },

        onTouchMove(e) {
            if (!this.isDrageMove) return

            // å°è¯•é˜»æ­¢é»˜è®¤æ»šåŠ¨å’Œäº‹ä»¶å†’æ³¡ï¼Œå¢åŠ å…¼å®¹æ€§ä¿æŠ¤
            try {
                if (e && typeof e.preventDefault === 'function') {
                    e.preventDefault()
                }
                if (e && e.stopPropagation && typeof e.stopPropagation === 'function') {
                    e.stopPropagation()
                }
            } catch (err) {
                // æŸäº›å°ç¨‹åºç¯å¢ƒä¸‹äº‹ä»¶å¯¹è±¡å¯èƒ½ä¸å®Œå…¨å…¼å®¹ï¼Œè¿™é‡Œå®‰å…¨é™çº§
                // console.debug('preventDefault/stopPropagation not available', err)
            }

            const touch = e.touches[0]

            // èŠ‚æµå¤„ç†ï¼Œå‡å°‘å¡é¡¿
            if (this._throttleTimer) return
            this._throttleTimer = setTimeout(() => {
                this._throttleTimer = null
            }, 16) // çº¦60fps

            if (this.isResizing) {
                // æ‹‰ä¼¸é€»è¾‘
                const deltaX = touch.pageX - this.resizeStartPos.x
                const deltaY = touch.pageY - this.resizeStartPos.y

                let newWidth = this.resizeStartSize.width + deltaX * 2 // rpxè½¬æ¢
                let newHeight = this.resizeStartSize.height + deltaY * 2 // rpxè½¬æ¢


                this.containerSize = {
                    width: newWidth,
                    height: newHeight
                }
            } else if (this.isDragging) {
                // æ‹–æ‹½é€»è¾‘
                const systemInfo = mpx.getWindowInfo()
                const windowWidth = systemInfo.windowWidth
                const windowHeight = systemInfo.windowHeight

                const deltaX = touch.pageX - this.dragStartPos.x
                const deltaY = touch.pageY - this.dragStartPos.y

                let newX = this.dragPosition.x + (deltaX / windowWidth) * 100
                let newY = this.dragPosition.y + (deltaY / windowHeight) * 100

                this.dragPosition = { x: newX, y: newY }

                // æ›´æ–°èµ·å§‹ä½ç½®
                this.dragStartPos = {
                    x: touch.pageX,
                    y: touch.pageY
                }
            }
        },
        validatePosition() {
            // ä»…åœ¨æ‚¬æµ®æ¨¡å¼ä¸‹æ‰éœ€è¦æ ¡éªŒä½ç½®
            if (!this.isDrageMove) return
            const isUnvisible = this.dragPosition.x < 0 || this.dragPosition.x > 100 || this.dragPosition.y < 0 || this.dragPosition.y > 100
            if (isUnvisible) {
                console.debug('Position out of bounds, resetting to center.')
                this.dragPosition = { x: 10, y: 10 }
                this.containerSize = { width: 400, height: 300 }
            }

        },
        onTouchEnd(e) {
            if (!this.isDrageMove) return

            this.isDragging = false
            this.isResizing = false
            this.saveToStorage() // æ‹–æ‹½æˆ–æ‹‰ä¼¸ç»“æŸåä¿å­˜
        },

        // æ‹‰ä¼¸æŒ‰é’®çš„è§¦æ‘¸äº‹ä»¶
        onResizeStart(e) {
            if (!this.isDrageMove) return

            const touch = e.touches[0]
            this.isResizing = true
            this.resizeStartPos = {
                x: touch.pageX,
                y: touch.pageY
            }
            this.resizeStartSize = { ...this.containerSize }
        },

        toggleCollapseGlobal() {
            this.isCollapsed = !this.isCollapsed;
            this.saveToStorage(); // æŠ˜å çŠ¶æ€æ”¹å˜æ—¶ä¿å­˜
        },

        updateComponentTree() {
            try {
                if (!mpx.mpxDevTools || typeof mpx.mpxDevTools.getInstanceTreeRoot !== 'function') {
                    mpx.showToast({
                        title: 'MPX DevTools API æœªå°±ç»ª',
                        icon: 'none'
                    })
                    return
                }

                const tree = mpx.mpxDevTools.getInstanceTreeRoot()

                // æ£€æŸ¥æ˜¯å¦è·å–åˆ°æœ‰æ•ˆçš„ç»„ä»¶æ ‘
                if (!tree) {
                    console.debug('No component tree available yet')
                    return
                }

                mpx.mpxDevToolsComponentRoot = tree
                this.componentTree = tree
                this.flattenTree = this.flattenTreeData(tree, 0, -1, [])
                this.updateVisibleNodes()
                this.updateTime = this.formatTime(new Date())
            } catch (error) {
                console.debug('Error updating component tree:', error)
            }
            this.validatePosition();
        },

        flattenTreeData(node, level, parentIndex = -1, allNodes = []) {
            if (!node || !node.component) return []

            try {
                // å®‰å…¨åœ°è·å–æ–‡ä»¶è·¯å¾„
                const fileSrc = node.component?.MpxDevtoolsComponentInfo?.__mpx_file_src__ || 'unknown'
                if (fileSrc === 'unknown') {
                    console.debug('Component with unknown fileSrc:', node)
                }
                const hasChildren = node.children && node.children.length > 0

                const currentIndex = allNodes.length
                const currentNode = {
                    level: level,
                    fileSrc: fileSrc,
                    hasChildren: hasChildren,
                    collapsed: false,
                    parentIndex: parentIndex
                }

                allNodes.push(currentNode)

                // é€’å½’å¤„ç†å­èŠ‚ç‚¹
                if (hasChildren) {
                    node.children.forEach(child => {
                        this.flattenTreeData(child, level + 1, currentIndex, allNodes)
                    })
                }

                return allNodes
            } catch (error) {
                console.error('Error flattening tree node:', error, node)
                return allNodes
            }
        },

        updateVisibleNodes() {
            const visible = []

            // å¦‚æœæœ‰æœç´¢æ¡ä»¶ï¼Œå…ˆæ‰§è¡Œæ•°æ®æœç´¢
            if (this.filterText) {
                this.performCombinedSearch()
            } else {
                // æ¸…ç©ºæœç´¢ç»“æœ
                this.dataSearchResults.clear()
            }

            for (let i = 0; i < this.flattenTree.length; i++) {
                const node = this.flattenTree[i]

                // æ£€æŸ¥çˆ¶èŠ‚ç‚¹æ˜¯å¦è¢«æŠ˜å 
                let isVisible = true
                let checkIndex = node.parentIndex

                while (checkIndex >= 0 && isVisible) {
                    const parentNode = this.flattenTree[checkIndex]
                    if (parentNode.collapsed) {
                        isVisible = false
                    }
                    checkIndex = parentNode.parentIndex
                }

                // æ£€æŸ¥æ˜¯å¦é€šè¿‡è¿‡æ»¤æ¡ä»¶
                if (isVisible && this.filterText) {
                    const displayFileName = this.getDisplayFileName(node.fileSrc)
                    const componentMatched = displayFileName.toLowerCase().includes(this.filterText.toLowerCase())

                    // æ£€æŸ¥æ˜¯å¦åœ¨æ•°æ®æœç´¢ç»“æœä¸­
                    const searchResult = this.dataSearchResults.get(node.fileSrc)
                    const dataMatched = searchResult && searchResult.isInPath

                    // ç»„ä»¶åç§°æˆ–æ•°æ®å€¼ä»»ä¸€åŒ¹é…å³å¯æ˜¾ç¤º
                    if (!componentMatched && !dataMatched) {
                        isVisible = false
                    }
                }

                if (isVisible) {
                    const searchResult = this.dataSearchResults.get(node.fileSrc)
                    visible.push({
                        ...node,
                        index: i, // ä¿å­˜åŸå§‹ç´¢å¼•ç”¨äºæŠ˜å æ“ä½œ
                        isHighlighted: searchResult && searchResult.hasMatch,
                        matchedProperties: searchResult ? searchResult.matchedProperties : []
                    })
                }
            }

            this.visibleNodes = visible
        },

        toggleCollapse(e) {
            const visibleIndex = parseInt(e.currentTarget.dataset.index)
            const node = this.visibleNodes[visibleIndex]

            // åªæœ‰æœ‰å­ç»„ä»¶çš„èŠ‚ç‚¹æ‰å…è®¸æŠ˜å 
            if (!node.hasChildren) {
                return
            }

            const originalIndex = node.index

            console.log('Toggle collapse:', {
                visibleIndex,
                originalIndex,
                currentState: this.flattenTree[originalIndex].collapsed
            })

            // åˆ‡æ¢æŠ˜å çŠ¶æ€
            this.flattenTree[originalIndex].collapsed = !this.flattenTree[originalIndex].collapsed

            // æ›´æ–°å¯è§èŠ‚ç‚¹
            this.updateVisibleNodes()
        },

        showComponentInfo(e) {
            const visibleIndex = parseInt(e.currentTarget.dataset.index)
            const node = this.visibleNodes[visibleIndex]

            // è·å–ç»„ä»¶å®ä¾‹æ•°æ®
            const componentInstance = this.getComponentInstance(node)
            if (!componentInstance) {
                mpx.showToast({
                    title: 'æ— æ³•è·å–ç»„ä»¶ä¿¡æ¯',
                    icon: 'none'
                })
                return
            }

            const componentInfo = this.parseComponentInfo(componentInstance, node.fileSrc)
            // ä¿å­˜ç»„ä»¶å®ä¾‹å¼•ç”¨ï¼Œç”¨äºåç»­çš„å±•å¼€æ“ä½œ
            this.currentComponentInfo = {
                ...componentInfo,
                componentInstance: componentInstance
            }
            this.showInfoModal = true
        },

        getComponentInstance(node) {
            // æ ¹æ®ç»„ä»¶æ ‘æŸ¥æ‰¾å¯¹åº”çš„ç»„ä»¶å®ä¾‹
            try {
                const findComponent = (treeNode, targetSrc) => {
                    if (!treeNode) return null

                    const fileSrc = treeNode.component?.MpxDevtoolsComponentInfo?.__mpx_file_src__
                    if (fileSrc === targetSrc) {
                        return treeNode.component
                    }

                    if (treeNode.children) {
                        for (let child of treeNode.children) {
                            const result = findComponent(child, targetSrc)
                            if (result) return result
                        }
                    }
                    return null
                }

                return findComponent(this.componentTree, node.fileSrc)
            } catch (error) {
                console.error('Error finding component:', error)
                return null
            }
        },

        parseComponentInfo(component, fileSrc) {
            const props = this.parseObjectProperties(component.MpxDevtoolsComponentInfo?.props || {}, 'props', component)
            const data = this.parseObjectProperties(component.MpxDevtoolsComponentInfo?.data || {}, 'data', component)
            const computed = this.parseObjectProperties(component.MpxDevtoolsComponentInfo?.computed || {}, 'computed', component)

            return {
                fileSrc: fileSrc,
                props: props,
                data: data,
                computed,
                propsCount: Object.keys(component.MpxDevtoolsComponentInfo?.props || {}).length,
                dataCount: Object.keys(component.MpxDevtoolsComponentInfo?.data || {}).length,
                computedCount: Object.keys(component.MpxDevtoolsComponentInfo?.computed || {}).length
            }
        },

        parseObjectProperties(obj, basePath = '', instance) {
            const result = []
            for (let key in obj) {
                if (key === '__mpx_file_src__') {
                    continue
                }
                const rawValue = instance[key]
                const type = this.getValueType(rawValue)
                const path = basePath ? `${basePath}.${key}` : key

                // åˆ¤æ–­æ˜¯å¦æ˜¯å¯å±•å¼€çš„ç±»å‹
                const isExpandable = type === 'Array' || type === 'Object'
                const isExpanded = false // é»˜è®¤æŠ˜å çŠ¶æ€

                // ä¸ºé•¿å†…å®¹åˆ›å»ºä¸åŒçš„æ˜¾ç¤ºç‰ˆæœ¬
                let collapsedValue, expandedValue

                if (isExpandable) {
                    collapsedValue = this.formatValue(rawValue, true) // æŠ˜å çŠ¶æ€
                    expandedValue = this.getFullFormattedValue(rawValue) // å±•å¼€çŠ¶æ€ï¼Œæ˜¾ç¤ºå®Œæ•´å†…å®¹
                } else {
                    collapsedValue = expandedValue = this.formatValue(rawValue, true)
                }

                // æ£€æŸ¥æ˜¯å¦åŒ¹é…å½“å‰æœç´¢æ¡ä»¶
                let isMatched = false
                if (this.filterText) {
                    const searchText = this.filterText.toLowerCase()
                    isMatched = this.searchInValue(rawValue, searchText)
                }

                const node = {
                    key: key,
                    value: rawValue,
                    displayValue: collapsedValue, // é»˜è®¤æ˜¾ç¤ºæŠ˜å çŠ¶æ€
                    collapsedValue: collapsedValue, // æŠ˜å æ—¶çš„æ˜¾ç¤º
                    expandedValue: expandedValue, // å±•å¼€æ—¶çš„æ˜¾ç¤º
                    valueColor: this.getValueColor(type),
                    type: type,
                    path: path,
                    isExpandable: isExpandable,
                    expanded: isExpanded,
                    children: [],
                    isMatched: isMatched // æ·»åŠ åŒ¹é…æ ‡è¯†
                }
                result.push(node)
            }

            return result
        },

        getValueType(value) {
            if (value === null) return 'null'
            if (value === undefined) return 'undefined'
            if (typeof value === 'string') return 'string'
            if (typeof value === 'number') return 'number'
            if (typeof value === 'boolean') return 'boolean'
            if (typeof value === 'function') return 'function'
            if (Array.isArray(value)) return 'Array'
            if (typeof value === 'object') return 'Object'
            return 'unknown'
        },

        formatValue(value, isCollapsed = true) {
            const type = this.getValueType(value)
            switch (type) {
                case 'string':
                    return `"${value}"`
                case 'number':
                case 'boolean':
                    return String(value)
                case 'null':
                    return 'null'
                case 'undefined':
                    return 'undefined'
                case 'function':
                    return 'function() {...}'
                case 'Array':
                    if (isCollapsed) {
                        return `Array(${value.length})`
                    }
                    try {
                        return this.formatJsonWithIndent(value)
                    } catch (error) {
                        console.debug('Error stringifying array:', error)
                        return `Array(${value.length})`
                    }
                case 'Object':
                    if (isCollapsed) {
                        const keys = Object.keys(value)
                        return `{${keys.length} ${keys.length === 1 ? 'key' : 'keys'}}`
                    }
                    try {
                        return this.formatJsonWithIndent(value)
                    } catch (error) {
                        console.debug('Error stringifying object:', error)
                        const keys = Object.keys(value)
                        return `{${keys.length} ${keys.length === 1 ? 'key' : 'keys'}}`
                    }
                default:
                    return String(value)
            }
        },

        // æ ¼å¼åŒ– JSON å¹¶æ·»åŠ æ­£ç¡®çš„ç¼©è¿›
        formatJsonWithIndent(value) {
            return this.getFullFormattedValue(value)
        },

        // è·å–å®Œæ•´æ ¼å¼åŒ–çš„å†…å®¹
        getFullFormattedValue(value) {
            try {
                const jsonStr = JSON.stringify(value, null, 2)
                // æ·»åŠ é€‚å½“çš„ç¼©è¿›ä»¥åœ¨å°ç¨‹åºä¸­æ­£ç¡®æ˜¾ç¤º
                return jsonStr.split('\n').map((line, index) => {
                    if (index === 0) return line
                    return `  ${line}` // æ·»åŠ ä¸¤ä¸ªç©ºæ ¼çš„ç¼©è¿›
                }).join('\n')
            } catch (error) {
                console.debug('Error formatting value:', error)
                const type = this.getValueType(value)
                if (type === 'Array') {
                    return `Array(${value.length}) [æ— æ³•åºåˆ—åŒ–]`
                } else if (type === 'Object') {
                    const keys = Object.keys(value)
                    return `{${keys.length} ${keys.length === 1 ? 'key' : 'keys'}} [æ— æ³•åºåˆ—åŒ–]`
                }
                return String(value)
            }
        },

        getValueColor(type) {
            switch (type) {
                case 'string': return '#d14'
                case 'number': return '#005cc5'
                case 'boolean': return '#d73a49'
                case 'null':
                case 'undefined': return '#6f42c1'
                case 'function': return '#e36209'
                case 'Array': return '#22863a'
                case 'Object': return '#6f42c1'
                default: return '#333'
            }
        },

        toggleObjectExpand(e) {
            const path = e.currentTarget.dataset.path
            const type = e.currentTarget.dataset.type

            console.log('Toggle expand:', { path, type })

            // æ ¹æ®ç±»å‹æ‰¾åˆ°å¯¹åº”çš„æ•°æ®æº
            let targetArray = null
            switch (type) {
                case 'props':
                    targetArray = this.currentComponentInfo.props
                    break
                case 'data':
                    targetArray = this.currentComponentInfo.data
                    break
                case 'computed':
                    targetArray = this.currentComponentInfo.computed
                    break
                default:
                    return
            }

            // æŸ¥æ‰¾å¹¶åˆ‡æ¢å±•å¼€çŠ¶æ€
            const item = targetArray.find(item => item.path === path)
            if (item && item.isExpandable) {
                // ç®€å•çš„äºŒçº§åˆ‡æ¢ï¼šæŠ˜å  <-> å±•å¼€
                item.expanded = !item.expanded
                item.displayValue = item.expanded ? item.expandedValue : item.collapsedValue

                console.log('Toggle state:', {
                    path: path,
                    expanded: item.expanded
                })
            }
        },

        closeInfoModal() {
            this.showInfoModal = false
            this.currentComponentInfo = null
        },

        preventClose() {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢ç‚¹å‡»å¼¹çª—å†…å®¹æ—¶å…³é—­
        },

        // é˜»æ­¢å¤åˆ¶æŒ‰é’®è§¦å‘å±•å¼€/æ”¶èµ·
        preventToggle(e) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
        },

        // å¤åˆ¶å±æ€§å€¼
        copyPropertyValue(e) {
            const { value, key, type } = e.currentTarget.dataset

            try {
                // åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ mpx.setClipboardData æ¥å¤åˆ¶å†…å®¹
                mpx.setClipboardData({
                    data: value || '',
                    success: () => {
                        mpx.showToast({
                            title: `å·²å¤åˆ¶${key}`,
                            icon: 'success',
                            duration: 1500
                        })
                    },
                    fail: (error) => {
                        console.error('å¤åˆ¶å¤±è´¥:', error)
                        mpx.showToast({
                            title: 'å¤åˆ¶å¤±è´¥',
                            icon: 'none',
                            duration: 1500
                        })
                    }
                })
            } catch (error) {
                console.error('å¤åˆ¶æ“ä½œå¼‚å¸¸:', error)
                mpx.showToast({
                    title: 'å¤åˆ¶åŠŸèƒ½ä¸å¯ç”¨',
                    icon: 'none',
                    duration: 1500
                })
            }
        },

        formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0')
            const minutes = date.getMinutes().toString().padStart(2, '0')
            const seconds = date.getSeconds().toString().padStart(2, '0')
            return `${hours}:${minutes}:${seconds}`
        },

        // æ ¼å¼åŒ–æ–‡ä»¶åæ˜¾ç¤º
        getDisplayFileName(fileSrc = '') {
            if (!fileSrc) {
                return 'æœªçŸ¥ç»„ä»¶'
            }

            // æå–æ–‡ä»¶åï¼ˆå»æ‰è·¯å¾„ï¼‰
            const fileName = fileSrc.split('/').pop()
            // å¦‚æœæ²¡æœ‰æ–‡ä»¶åæˆ–è€…æ–‡ä»¶åä¸ºç©ºï¼Œè¿”å›é»˜è®¤å€¼
            if (!fileName || fileName.trim() === '') {
                return 'æœªçŸ¥ç»„ä»¶'
            }

            return fileName
        },

        // å¤„ç†è¿‡æ»¤è¾“å…¥
        onFilterInput(e) {
            this.filterText = e.detail.value
            this.dataSearchResults.clear()
            this.updateVisibleNodes()
        },

        // å¤„ç†ç¡®è®¤è¾“å…¥
        onFilterConfirm(e) {
            this.filterText = e.detail.value
            this.dataSearchResults.clear()
            this.updateVisibleNodes()
        },

        // æ¸…é™¤è¿‡æ»¤
        clearFilter() {
            this.filterText = ''
            this.dataSearchResults.clear()
            this.updateVisibleNodes()
        },

        // æ‰§è¡Œç»„åˆæœç´¢ï¼ˆåŒæ—¶æœç´¢ç»„ä»¶åç§°å’Œæ•°æ®å€¼ï¼‰
        performCombinedSearch() {
            if (!this.filterText || !this.componentTree) {
                this.dataSearchResults.clear()
                return
            }

            const searchText = this.filterText.toLowerCase()
            const results = new Map()

            // é€’å½’æœç´¢ç»„ä»¶æ ‘
            const searchInComponent = (treeNode, path = []) => {
                if (!treeNode || !treeNode.component) return

                const component = treeNode.component
                const fileSrc = component.MpxDevtoolsComponentInfo?.__mpx_file_src__
                if (!fileSrc) return

                const currentPath = [...path, fileSrc]
                let hasDirectMatch = false
                let matchedProperties = []

                // æœç´¢ç»„ä»¶çš„ data, props, computed
                const searchInProperties = (obj, type) => {
                    if (!obj) return []
                    const matches = []

                    Object.keys(obj).forEach(key => {
                        const value = component[key]
                        if (this.searchInValue(value, searchText)) {
                            matches.push(`${type}.${key}`)
                        }
                    })
                    return matches
                }

                // æœç´¢å„ç§å±æ€§
                const dataMatches = searchInProperties(component.MpxDevtoolsComponentInfo?.data || {}, 'data')
                const propsMatches = searchInProperties(component.MpxDevtoolsComponentInfo?.props || {}, 'props')
                const computedMatches = searchInProperties(component.MpxDevtoolsComponentInfo?.computed || {}, 'computed')

                matchedProperties = [...dataMatches, ...propsMatches, ...computedMatches]
                hasDirectMatch = matchedProperties.length > 0

                // å¦‚æœå½“å‰ç»„ä»¶æœ‰åŒ¹é…ï¼Œæ ‡è®°æ•´ä¸ªè·¯å¾„
                if (hasDirectMatch) {
                    currentPath.forEach(pathFileSrc => {
                        if (!results.has(pathFileSrc)) {
                            results.set(pathFileSrc, {
                                hasMatch: false,
                                isInPath: false,
                                matchedProperties: []
                            })
                        }
                        const existingResult = results.get(pathFileSrc)
                        existingResult.isInPath = true

                        // å¦‚æœæ˜¯å½“å‰ç»„ä»¶ï¼Œæ ‡è®°ä¸ºæœ‰ç›´æ¥åŒ¹é…
                        if (pathFileSrc === fileSrc) {
                            existingResult.hasMatch = true
                            existingResult.matchedProperties = matchedProperties
                        }
                    })
                }

                // é€’å½’æœç´¢å­ç»„ä»¶
                if (treeNode.children) {
                    treeNode.children.forEach(child => {
                        searchInComponent(child, currentPath)
                    })
                }
            }

            searchInComponent(this.componentTree)
            this.dataSearchResults = results
        },

        // åœ¨å€¼ä¸­æœç´¢æ–‡æœ¬
        searchInValue(value, searchText) {
            if (value === null || value === undefined) {
                return false
            }

            if (typeof value === 'string') {
                return value.toLowerCase().includes(searchText)
            }

            if (typeof value === 'number' || typeof value === 'boolean') {
                return String(value).toLowerCase().includes(searchText)
            }

            if (Array.isArray(value)) {
                return value.some(item => this.searchInValue(item, searchText)) ||
                    JSON.stringify(value).toLowerCase().includes(searchText)
            }

            if (typeof value === 'object') {
                try {
                    return JSON.stringify(value).toLowerCase().includes(searchText) ||
                        Object.keys(value).some(key =>
                            key.toLowerCase().includes(searchText) ||
                            this.searchInValue(value[key], searchText)
                        )
                } catch (error) {
                    return false
                }
            }

            return false
        }
    },

    [MOUNTED]() {
        console.debug('MPX DevTools component mounted')
        this.osimEnv = mpx.getStorageSync('osimEnv') || '000'
        this.osimEnvInput = this.osimEnv
        // åŠ è½½å­˜å‚¨çš„è®¾ç½®
        this.loadFromStorage()
        // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç­‰å¾… MPX DevTools API å‡†å¤‡å°±ç»ª
        const initDevTools = () => {
            if (mpx.mpxDevTools && typeof mpx.mpxDevTools.getInstanceTreeRoot === 'function') {
                console.debug('MPX DevTools API is ready, initializing...')
                this.updateComponentTree()

                // è®¾ç½®å®šæ—¶å™¨ï¼Œå®šæœŸåˆ·æ–°ç»„ä»¶æ ‘
                this.timer = setInterval(() => {
                    this.updateComponentTree()
                }, 10000) // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
            } else {
                mpx_devtools.mixin(mpxDevToolsMixin_devtools)
                console.debug('MPX DevTools API not ready, retrying...')
                // å¦‚æœAPIè¿˜æ²¡å‡†å¤‡å¥½ï¼Œ5ç§’åé‡è¯•
                setTimeout(initDevTools, 5000)
            }
        }

        // ç«‹å³å°è¯•åˆå§‹åŒ–
        initDevTools()
    },

    [BEFOREUNMOUNT]() {
        this.clearTimer()
    },
    [UNMOUNTED]() {
        this.clearTimer()
    },
    [ONHIDE]() {
        this.clearTimer()

    },
    watch: {
        // ç›‘å¬æŠ˜å çŠ¶æ€å˜åŒ–ï¼Œä¿å­˜åˆ°å­˜å‚¨
        isCollapsed(newVal) {
            this.osimEnvInput = this.osimEnv

        },
    },
    computed: {
        tabList() {
            return [
                { key: 'props', label: `Props (${this.currentComponentInfo ? this.currentComponentInfo.propsCount : 0})` },
                { key: 'data', label: `Data (${this.currentComponentInfo ? this.currentComponentInfo.dataCount : 0})` },
                { key: 'computed', label: `Computed (${this.currentComponentInfo ? this.currentComponentInfo.computedCount : 0})` },
            ]
        },
        visibleNodesWithDisplayName() {
            return this.visibleNodes.map(item => ({
                ...item,
                displayFileName: this.getDisplayFileName(item.fileSrc)
            })).filter(item => item.displayFileName !== 'æœªçŸ¥ç»„ä»¶')
        }
    },
})
</script>

<style lang="stylus">
/* ==============================================
1. åŸºç¡€å®¹å™¨æ ·å¼ï¼ˆæ ¹å®¹å™¨ï¼‰
============================================== */
.mpx-devtools-container
    padding 20rpx
    background linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)
    transition all 0.3s ease
    display flex
    flex-direction column

/* å®¹å™¨ä¿®æ”¹å™¨ï¼šæŠ˜å çŠ¶æ€ */
.mpx-devtools-container--collapsed
    width max-content
    padding 0rpx !important
    height auto !important
    overflow scroll
    max-width 360rpx

/* å®¹å™¨ä¿®æ”¹å™¨ï¼šæ‚¬æµ®çŠ¶æ€ */
.mpx-devtools-container--floating
    position fixed
    z-index 1000
    box-shadow 0 8rpx 32rpx rgba(0, 0, 0, 0.2)
    border-radius 20rpx
    backdrop-filter blur(20rpx)
    border 2rpx solid rgba(66, 153, 225, 0.3)
    overflow hidden

/* ==============================================
2. å¤´éƒ¨åŒºåŸŸæ ·å¼ï¼ˆHeaderï¼‰
============================================== */
.mpx-devtools-header
    background linear-gradient(135deg, #4299e1 0%, #3182ce 100%)
    padding 24rpx
    border-radius 16rpx
    box-shadow 0 8rpx 32rpx rgba(66, 153, 225, 0.3)
    color white
    transition all 0.3s ease
    position relative

/* å¤´éƒ¨ä¿®æ”¹å™¨ï¼šæŠ˜å çŠ¶æ€ */
.mpx-devtools-header--collapsed
    padding 20rpx 30rpx
    margin-bottom 0rpx
    box-shadow 0 4rpx 16rpx rgba(66, 153, 225, 0.2)

/* å¤´éƒ¨é¡¶éƒ¨å®¹å™¨ï¼ˆæ ‡é¢˜+çŠ¶æ€åŒºï¼‰ */
.mpx-devtools-header__top
    display flex
    justify-content space-between
    align-items center
    transition margin-bottom 0.3s ease

/* æŠ˜å çŠ¶æ€ä¸‹çš„é¡¶éƒ¨å®¹å™¨ */
.mpx-devtools-header--collapsed .mpx-devtools-header__top
    margin-bottom 0

/* æ ‡é¢˜åŒºåŸŸ */
.mpx-devtools-title-section
    flex 1
    min-width 0
    overflow hidden

/* æ ‡é¢˜æ–‡æœ¬ */
.mpx-devtools-title
    font-size 36rpx
    font-weight 600
    color white
    display block
    margin-bottom 8rpx
    letter-spacing 1rpx
    transition all 0.3s ease
    white-space nowrap
    overflow hidden
    text-overflow ellipsis

/* æŠ˜å çŠ¶æ€ä¸‹çš„æ ‡é¢˜ */
.mpx-devtools-header--collapsed .mpx-devtools-title
    font-size 28rpx
    margin-bottom 0

/* çŠ¶æ€åŒºåŸŸï¼ˆåˆ·æ–°+æŠ˜å æŒ‰é’®ï¼‰ */
.mpx-devtools-status-section
    display flex
    flex-direction column
    align-items flex-end
    gap 12rpx

/* æŠ˜å çŠ¶æ€ä¸‹çš„çŠ¶æ€åŒºåŸŸ */
.mpx-devtools-header--collapsed .mpx-devtools-status-section
    flex-direction row
    align-items center
    gap 0

/* æ‹–æ‹½æŒ‡ç¤ºå™¨ */
.mpx-devtools-drag-indicator
    position absolute
    top 8rpx
    left 50%
    transform translateX(-50%)
    display flex
    align-items center
    justify-content center
    width 60rpx
    height 12rpx
    border-radius 6rpx
    background rgba(255, 255, 255, 0.4)
    cursor grab

.mpx-devtools-drag-indicator:active
    cursor grabbing

/* æ‹–æ‹½å›¾æ ‡ */
.mpx-devtools-drag-icon
    font-size 16rpx
    color rgba(255, 255, 255, 0.8)
    line-height 1
    letter-spacing 2rpx

/* åˆ·æ–°æŒ‰é’®æ–‡æœ¬ */
.mpx-devtools-update-time
    font-size 22rpx
    color rgba(255, 255, 255, 0.9)
    background rgba(255, 255, 255, 0.15)
    padding 8rpx 12rpx
    border-radius 20rpx
    backdrop-filter blur(10rpx)

/* æŠ˜å æŒ‰é’® */
.mpx-devtools-collapse-btn
    display flex
    align-items center
    gap 8rpx
    background rgba(255, 255, 255, 0.2)
    border-radius 24rpx
    padding 8rpx 16rpx
    margin-left 16rpx
    backdrop-filter blur(10rpx)
    border 1rpx solid rgba(255, 255, 255, 0.3)
    transition all 0.3s ease
    cursor pointer

.mpx-devtools-collapse-btn:active
    transform scale(0.95)
    background rgba(255, 255, 255, 0.3)

/* æŠ˜å æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-collapse-btn__icon
    font-size 24rpx
    line-height 1
    transition transform 0.3s ease

/* æŠ˜å æŒ‰é’®æ–‡æœ¬ */
.mpx-devtools-collapse-btn__text
    font-size 22rpx
    color rgba(255, 255, 255, 0.95)
    font-weight 500

/* ==============================================
3. è¿‡æ»¤åŒºåŸŸæ ·å¼ï¼ˆFilterï¼‰
============================================== */
.mpx-devtools-filter-container
    background rgba(255, 255, 255, 0.15)
    border-radius 4rpx
    padding 16rpx 0
    backdrop-filter blur(10rpx)
    border 1rpx solid rgba(255, 255, 255, 0.2)

/* è¿‡æ»¤è¾“å…¥å®¹å™¨ */
.mpx-devtools-filter-wrapper
    display flex
    align-items center
    background rgba(255, 255, 255, 0.9)
    border-radius 18rpx
    padding 4rpx 8rpx 4rpx 16rpx
    box-shadow 0 4rpx 16rpx rgba(0, 0, 0, 0.1)

/* è¿‡æ»¤å›¾æ ‡ */
.mpx-devtools-filter-wrapper__icon
    font-size 28rpx
    margin-right 12rpx
    color #666

/* è¿‡æ»¤è¾“å…¥æ¡† */
.mpx-devtools-filter-wrapper__input
    flex 1
    height 48rpx
    padding 0 12rpx
    font-size 26rpx
    background-color transparent
    border none
    color #333
    outline none

.mpx-devtools-filter-wrapper__input::placeholder
    color #999

/* è¿‡æ»¤æ¸…é™¤æŒ‰é’® */
.mpx-devtools-filter-wrapper__clear-btn
    width 36rpx
    height 36rpx
    display flex
    align-items center
    justify-content center
    margin-left 8rpx
    background rgba(0, 0, 0, 0.1)
    border-radius 50%
    flex-shrink 0
    transition all 0.3s ease

.mpx-devtools-filter-wrapper__clear-btn:active
    background rgba(0, 0, 0, 0.2)
    transform scale(0.9)

/* æ¸…é™¤æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-filter-wrapper__clear-icon
    font-size 20rpx
    color #666
    line-height 1
    font-weight bold

/* ==============================================
4. ä¸»ä½“å†…å®¹åŒºæ ·å¼ï¼ˆMainï¼‰
============================================== */
.mpx-devtools-main
    height 100%
    overflow hidden

/* ç»„ä»¶æ ‘å®¹å™¨ */
.mpx-devtools-tree-container
    background linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)
    border-radius 16rpx
    padding 20rpx
    box-shadow 0 4rpx 20rpx rgba(66, 153, 225, 0.15)
    border 2rpx solid rgba(66, 153, 225, 0.2)
    overflow scroll
    height 100%

/* ç©ºçŠ¶æ€ï¼ˆæ— ç»„ä»¶æ•°æ®ï¼‰ */
.mpx-devtools-empty-state
    background linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)
    border-radius 8rpx
    padding 10rpx 5rpx
    text-align center
    border 2rpx dashed rgba(66, 153, 225, 0.4)
    margin-top 10rpx

/* ç©ºçŠ¶æ€æ–‡æœ¬ */
.mpx-devtools-empty-state__text
    font-size 30rpx
    color #2d74d8
    font-weight 400
    display block
    margin-bottom 2rpx

/* ç©ºçŠ¶æ€æç¤º */
.mpx-devtools-empty-state__hint
    font-size 26rpx
    color #4299e1
    display block
    opacity 0.8

/* ==============================================
5. æ ‘èŠ‚ç‚¹æ ·å¼ï¼ˆTree Nodeï¼‰
============================================== */
.mpx-devtools-tree-node
    padding 12rpx 0
    border-bottom 1rpx solid rgba(66, 153, 225, 0.15)
    white-space nowrap
    display inline-block
    min-width 100%
    width max-content

.mpx-devtools-tree-node:last-child
    border-bottom none

/* èŠ‚ç‚¹å†…å®¹å®¹å™¨ */
.mpx-devtools-tree-node__content
    display inline-flex
    align-items center
    min-width 100%
    width max-content

/* èŠ‚ç‚¹æŠ˜å æŒ‰é’® */
.mpx-devtools-tree-node__collapse-btn
    width 40rpx
    height 40rpx
    display flex
    align-items center
    justify-content center
    margin-right 10rpx
    background linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%)
    border 1rpx solid rgba(66, 153, 225, 0.3)
    border-radius 50%
    flex-shrink 0
    transition all 0.3s ease

.mpx-devtools-tree-node__collapse-btn:active
    transform scale(0.95)
    background linear-gradient(135deg, #dbeafe 0%, #e6f3ff 100%)

/* æŠ˜å æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-tree-node__collapse-icon
    font-size 24rpx
    color #2d74d8
    font-weight bold
    line-height 1

/* èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’® */
.mpx-devtools-tree-node__info-btn
    width 40rpx
    height 40rpx
    display flex
    align-items center
    justify-content center
    margin-right 10rpx
    background linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%)
    border 1rpx solid rgba(66, 153, 225, 0.3)
    border-radius 50%
    flex-shrink 0
    transition all 0.3s ease

.mpx-devtools-tree-node__info-btn:active
    transform scale(0.95)
    background linear-gradient(135deg, #dbeafe 0%, #e6f3ff 100%)

/* ä¿¡æ¯æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-tree-node__info-icon
    font-size 24rpx
    color #2d74d8
    font-weight bold
    line-height 1

/* èŠ‚ç‚¹æ–‡ä»¶å®¹å™¨ */
.mpx-devtools-tree-node__file-container
    flex-shrink 0
    white-space nowrap
    flex 1
    display flex
    flex-direction column
    align-items flex-start

/* èŠ‚ç‚¹æ–‡æœ¬ */
.mpx-devtools-tree-node__text
    font-size 26rpx
    color #2c5282
    font-family 'Monaco', 'Menlo', 'Ubuntu Mono', monospace
    white-space nowrap
    font-weight 500
    text-shadow 0 1rpx 2rpx rgba(66, 153, 225, 0.1)
    transition color 0.3s ease

/* èŠ‚ç‚¹æ–‡æœ¬ä¿®æ”¹å™¨ï¼šé«˜äº®ï¼ˆæœç´¢åŒ¹é…ï¼‰ */
.mpx-devtools-tree-node__text--highlighted
    color #dc2626
    font-weight 600
    text-shadow 0 1rpx 2rpx rgba(220, 38, 38, 0.2)

/* åŒ¹é…å±æ€§å®¹å™¨ */
.mpx-devtools-tree-node__matched-properties
    display flex
    flex-wrap wrap
    margin-top 6rpx
    gap 8rpx

/* åŒ¹é…å±æ€§æ–‡æœ¬ */
.mpx-devtools-tree-node__matched-prop
    font-size 20rpx
    color #dc2626
    background rgba(220, 38, 38, 0.1)
    padding 2rpx 8rpx
    border-radius 4rpx
    border 1rpx solid rgba(220, 38, 38, 0.3)
    font-family 'Monaco', 'Menlo', 'Ubuntu Mono', monospace
    font-weight 500

/* ==============================================
6. å¼¹çª—æ ·å¼ï¼ˆModalï¼‰
============================================== */
/* å¼¹çª—é®ç½© */
.mpx-devtools-modal-overlay
    position fixed
    top 0
    left 0
    right 0
    bottom 0
    background-color rgba(0, 0, 0, 0.5)
    z-index 99999
    display flex
    align-items center
    justify-content center

/* å¼¹çª—å®¹å™¨ */
.mpx-devtools-modal
    background-color #fff
    border-radius 20rpx
    width 90%
    max-width 700rpx
    max-height 60vh
    overflow hidden
    z-index 99999
    box-shadow 0 10rpx 30rpx rgba(0, 0, 0, 0.3)

/* å¼¹çª—å¤´éƒ¨ */
.mpx-devtools-modal__header
    background linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)
    padding 30rpx
    border-bottom 2rpx solid rgba(66, 153, 225, 0.2)
    display flex
    justify-content space-between
    align-items center

/* å¼¹çª—æ ‡é¢˜ */
.mpx-devtools-modal__title
    font-size 32rpx
    font-weight 600
    color #2c5282

/* å¼¹çª—å…³é—­æŒ‰é’® */
.mpx-devtools-modal__close-btn
    width 50rpx
    height 50rpx
    display flex
    align-items center
    justify-content center
    background linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%)
    border 1rpx solid rgba(66, 153, 225, 0.3)
    border-radius 50%
    transition all 0.3s ease

.mpx-devtools-modal__close-btn:active
    transform scale(0.95)
    background linear-gradient(135deg, #dbeafe 0%, #e6f3ff 100%)

/* å…³é—­æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-modal__close-icon
    font-size 40rpx
    padding-bottom 8rpx
    color #2d74d8
    line-height 1

/* å¼¹çª—å†…å®¹ */
.mpx-devtools-modal__content
    padding 30rpx
    max-height 60vh

/* ç»„ä»¶è·¯å¾„å®¹å™¨ */
.mpx-devtools-component-path
    margin-bottom 30rpx
    display flex
    align-items center
    padding 20rpx
    background linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)
    border-radius 12rpx
    border 1rpx solid rgba(66, 153, 225, 0.2)

/* è·¯å¾„æ ‡ç­¾ */
.mpx-devtools-component-path__label
    font-size 24rpx
    color #2d74d8
    margin-right 10rpx
    white-space nowrap
    font-weight 500

/* è·¯å¾„æ–‡æœ¬ */
.mpx-devtools-component-path__text
    font-size 24rpx
    color #2c5282
    font-family 'Monaco', 'Menlo', 'Ubuntu Mono', monospace
    word-break break-all
    font-weight 500

/* ==============================================
7. å¼¹çª—Sectionæ ·å¼ï¼ˆProps/DataåŒºåŸŸï¼‰
============================================== */
.mpx-devtools-section
    margin-bottom 30rpx
    overflow-y auto
    height 35vh

/* Sectionå¤´éƒ¨ */
.mpx-devtools-section__header
    margin-bottom 20rpx
    padding-bottom 10rpx
    border-bottom 2rpx solid rgba(66, 153, 225, 0.2)

/* Sectionæ ‡é¢˜ */
.mpx-devtools-section__title
    font-size 28rpx
    font-weight 600
    color #2d74d8

/* Sectionå†…å®¹ */
.mpx-devtools-section__content
    background linear-gradient(135deg, #fdfeff 0%, #f8fcff 100%)
    border-radius 12rpx
    padding 24rpx
    border 1rpx solid rgba(66, 153, 225, 0.2)

/* ==============================================
9. å¤åˆ¶æŒ‰é’®æ ·å¼ï¼ˆCopy Btnï¼‰
============================================== */
.mpx-devtools-copy-btn
    margin-right 8rpx
    cursor pointer

/* å¤åˆ¶æŒ‰é’®ä¿®æ”¹å™¨ï¼šå¯å±•å¼€å±æ€§ä¸­ */
.mpx-devtools-copy-btn--expandable
    margin-right 12rpx

/* å¤åˆ¶æŒ‰é’®å›¾æ ‡ */
.mpx-devtools-copy-btn__icon
    font-size 22rpx
    color #666
    cursor pointer
    transition color 0.3s ease

.mpx-devtools-copy-btn:hover .mpx-devtools-copy-btn__icon
    color #1890ff

/* ==============================================
10. æ‹‰ä¼¸æ§åˆ¶å™¨æ ·å¼ï¼ˆResizeï¼‰
============================================== */
.mpx-devtools-resize-controls
    position absolute
    width 100%
    height 100%
    pointer-events none
    top 0
    left 0

/* æ‹‰ä¼¸æ‰‹æŸ„ */
.mpx-devtools-resize-handle
    position absolute
    width 50rpx
    height 50rpx
    background linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%)
    border 2rpx solid rgba(66, 153, 225, 0.5)
    border-radius 50%
    display flex
    align-items center
    justify-content center
    cursor se-resize
    pointer-events auto
    transition all 0.3s ease
    z-index 10

.mpx-devtools-resize-handle:active
    transform scale(1.1)
    background linear-gradient(135deg, #dbeafe 0%, #e6f3ff 100%)
    border-color rgba(66, 153, 225, 0.8)

/* æ‹‰ä¼¸æ‰‹æŸ„ä¿®æ”¹å™¨ï¼šå³ä¸‹è§’ */
.mpx-devtools-resize-handle--br
    bottom -5rpx
    right -5rpx

/* æ‹‰ä¼¸å›¾æ ‡ */
.mpx-devtools-resize-handle__icon
    font-size 20rpx
    color #2d74d8
    font-weight bold
    line-height 1

/* ==============================================
11. ç¯å¢ƒè®¾ç½®åŒºåŸŸæ ·å¼ï¼ˆEnvï¼‰
============================================== */
.mpx-devtools-env
    display flex
    flex-wrap nowrap
    align-items center
    gap 12rpx
    padding 5rpx 10rpx
    background rgba(255, 255, 255, 0.04)
    border-radius 12rpx
    margin-top 12rpx
    border 1rpx solid rgba(255, 255, 255, 0.06)

.mpx-devtools-env__label
    font-size 28rpx
    margin-left 5rpx
    display flex
    align-items center

.mpx-devtools-env__controls
    display flex
    flex 1
    align-items center

/* ä¼˜åŒ–ç¯å¢ƒè¾“å…¥æ§ä»¶ï¼šè¾“å…¥æ¡†å’ŒæŒ‰é’® */
.mpx-devtools-env__input
    height 50rpx
    min-width 160rpx
    width 40%
    padding 0 14rpx
    font-size 26rpx
    border-radius 8rpx
    border 1rpx solid rgba(66, 153, 225, 0.12)
    background rgba(240, 240, 240, 0.95)
    color #222
    outline none
    margin 0 20rpx 0 10rpx
    transition all 0.18s ease
    box-shadow 0 2rpx 6rpx rgba(0, 0, 0, 0.04)

.mpx-devtools-env__input:focus
    border-color rgba(66, 153, 225, 0.28)
    box-shadow 0 4rpx 12rpx rgba(66, 153, 225, 0.08)

.mpx-devtools-env__btn
    height 56rpx
    margin-left 12rpx
    border-radius 10rpx
    background linear-gradient(135deg, #38a3f5 0%, #2b82d6 100%)
    color #fff
    font-size 26rpx
    font-weight 600
    display flex
    justify-content center
    align-items center
    margin-bottom 8rpx
    border none
    box-shadow 0 6rpx 18rpx rgba(43, 130, 214, 0.22)
    cursor pointer
    transition transform 0.14s ease, box-shadow 0.14s ease, opacity 0.14s ease

.mpx-devtools-env__btn:active
    transform translateY(1rpx) scale(0.995)
    box-shadow 0 4rpx 12rpx rgba(43, 130, 214, 0.18)

/* åœ¨å°å°ºå¯¸å®¹å™¨ä¸­å…è®¸æ¢è¡Œæ˜¾ç¤ºï¼Œé¿å…æº¢å‡º */
@media (max-width 420px)
    .mpx-devtools-env
        flex-wrap wrap

    .mpx-devtools-env__input
        width 100%
        min-width 0

    .mpx-devtools-env__btn
        width 100%
        margin-left 0
        margin-top 8rpx
</style>